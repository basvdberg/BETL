-- EXEC sp_generate_merge @schema = 'dbo', @table_name ='Error', @delete_if_not_matched =0
-- WARNING : do not delete records in dbo tables !

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

SET NOCOUNT ON

SET IDENTITY_INSERT [dbo].[error] ON

MERGE INTO [dbo].[error] AS [Target]
USING (VALUES
  (-1,-1,N'unknown',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,'2020-02-20T13:15:15.617',NULL)
) AS [Source] ([error_id],[error_code],[error_msg],[error_line],[error_procedure],[error_procedure_id],[error_execution_id],[error_event_name],[error_severity],[error_state],[error_source],[error_interactive_mode],[error_machine_name],[error_user_name],[transfer_id],[record_dt],[record_user])
ON ([Target].[error_id] = [Source].[error_id])
WHEN MATCHED AND (
	NULLIF([Source].[error_code], [Target].[error_code]) IS NOT NULL OR NULLIF([Target].[error_code], [Source].[error_code]) IS NOT NULL OR 
	NULLIF([Source].[error_msg], [Target].[error_msg]) IS NOT NULL OR NULLIF([Target].[error_msg], [Source].[error_msg]) IS NOT NULL OR 
	NULLIF([Source].[error_line], [Target].[error_line]) IS NOT NULL OR NULLIF([Target].[error_line], [Source].[error_line]) IS NOT NULL OR 
	NULLIF([Source].[error_procedure], [Target].[error_procedure]) IS NOT NULL OR NULLIF([Target].[error_procedure], [Source].[error_procedure]) IS NOT NULL OR 
	NULLIF([Source].[error_procedure_id], [Target].[error_procedure_id]) IS NOT NULL OR NULLIF([Target].[error_procedure_id], [Source].[error_procedure_id]) IS NOT NULL OR 
	NULLIF([Source].[error_execution_id], [Target].[error_execution_id]) IS NOT NULL OR NULLIF([Target].[error_execution_id], [Source].[error_execution_id]) IS NOT NULL OR 
	NULLIF([Source].[error_event_name], [Target].[error_event_name]) IS NOT NULL OR NULLIF([Target].[error_event_name], [Source].[error_event_name]) IS NOT NULL OR 
	NULLIF([Source].[error_severity], [Target].[error_severity]) IS NOT NULL OR NULLIF([Target].[error_severity], [Source].[error_severity]) IS NOT NULL OR 
	NULLIF([Source].[error_state], [Target].[error_state]) IS NOT NULL OR NULLIF([Target].[error_state], [Source].[error_state]) IS NOT NULL OR 
	NULLIF([Source].[error_source], [Target].[error_source]) IS NOT NULL OR NULLIF([Target].[error_source], [Source].[error_source]) IS NOT NULL OR 
	NULLIF([Source].[error_interactive_mode], [Target].[error_interactive_mode]) IS NOT NULL OR NULLIF([Target].[error_interactive_mode], [Source].[error_interactive_mode]) IS NOT NULL OR 
	NULLIF([Source].[error_machine_name], [Target].[error_machine_name]) IS NOT NULL OR NULLIF([Target].[error_machine_name], [Source].[error_machine_name]) IS NOT NULL OR 
	NULLIF([Source].[error_user_name], [Target].[error_user_name]) IS NOT NULL OR NULLIF([Target].[error_user_name], [Source].[error_user_name]) IS NOT NULL OR 
	NULLIF([Source].[transfer_id], [Target].[transfer_id]) IS NOT NULL OR NULLIF([Target].[transfer_id], [Source].[transfer_id]) IS NOT NULL OR 
	NULLIF([Source].[record_dt], [Target].[record_dt]) IS NOT NULL OR NULLIF([Target].[record_dt], [Source].[record_dt]) IS NOT NULL OR 
	NULLIF([Source].[record_user], [Target].[record_user]) IS NOT NULL OR NULLIF([Target].[record_user], [Source].[record_user]) IS NOT NULL) THEN
 UPDATE SET
  [error_code] = [Source].[error_code], 
  [error_msg] = [Source].[error_msg], 
  [error_line] = [Source].[error_line], 
  [error_procedure] = [Source].[error_procedure], 
  [error_procedure_id] = [Source].[error_procedure_id], 
  [error_execution_id] = [Source].[error_execution_id], 
  [error_event_name] = [Source].[error_event_name], 
  [error_severity] = [Source].[error_severity], 
  [error_state] = [Source].[error_state], 
  [error_source] = [Source].[error_source], 
  [error_interactive_mode] = [Source].[error_interactive_mode], 
  [error_machine_name] = [Source].[error_machine_name], 
  [error_user_name] = [Source].[error_user_name], 
  [transfer_id] = [Source].[transfer_id], 
  [record_dt] = [Source].[record_dt], 
  [record_user] = [Source].[record_user]
WHEN NOT MATCHED BY TARGET THEN
 INSERT([error_id],[error_code],[error_msg],[error_line],[error_procedure],[error_procedure_id],[error_execution_id],[error_event_name],[error_severity],[error_state],[error_source],[error_interactive_mode],[error_machine_name],[error_user_name],[transfer_id],[record_dt],[record_user])
 VALUES([Source].[error_id],[Source].[error_code],[Source].[error_msg],[Source].[error_line],[Source].[error_procedure],[Source].[error_procedure_id],[Source].[error_execution_id],[Source].[error_event_name],[Source].[error_severity],[Source].[error_state],[Source].[error_source],[Source].[error_interactive_mode],[Source].[error_machine_name],[Source].[error_user_name],[Source].[transfer_id],[Source].[record_dt],[Source].[record_user])
;
GO
DECLARE @mergeError int
 , @mergeCount int
SELECT @mergeError = @@ERROR, @mergeCount = @@ROWCOUNT
IF @mergeError != 0
 BEGIN
 PRINT 'ERROR OCCURRED IN MERGE FOR [dbo].[error]. Rows affected: ' + CAST(@mergeCount AS VARCHAR(100)); -- SQL should always return zero rows affected
 END
ELSE
 BEGIN
 PRINT '[dbo].[error] rows affected by MERGE: ' + CAST(@mergeCount AS VARCHAR(100));
 END
GO

SET IDENTITY_INSERT [dbo].[error] OFF

SET NOCOUNT OFF


